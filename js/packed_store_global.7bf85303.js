"use strict";(function(t){var e=this.sellfy||{};e.CartView=function(i){this.$scope=t(i),this.callback=null,this.onFetchAlways=null,this.onWidgetShow=null,this.onWidgetHide=null,this.formTimeoutId=null,this.formTimeout=1e3,this.addressBarHeight=window.outerHeight-window.innerHeight,window._&&(window.sellfy._=window._),this.$=function(t){return this.$scope.find(t)},this.templates={base:t(this.$scope.data("base-template")).html(),items:t("#shoppingCartItemsView").html(),totals:t("#shoppingCartTotalsView").html(),subtotals:t("#shoppingCartSubTotalsView").html(),upsell:t("#upsellModal").html(),upsellApproveText:t("#upsellApproveText").html(),error:{header:t("#defaultErrorHeader").html(),error:t("#defaultErrorBody").html()}},this.fullUrl=this.$scope.data("href"),this.$content=this.$(".shopping-cart-content"),this.$counter=this.$(".item-count"),this.$iframeContent=t(".shopping-cart-embed"),this.visitorId=e.helpers.getURLParameter(window.location.href,"visitor_id"),this.url=function(t){var i=this.fullUrl,n=t||{};return n.key&&(i="{0}{1}/".format(this.fullUrl,n.key)),void 0===n.visitorId&&(n.visitorId=this.visitorId),e.helpers.addUrlGetParameter(i,"visitor_id={0}".format(n.visitorId))},this.resizeTo=function(e){this.$iframeContent.length&&!t("body").hasClass("wix")&&(this.currentHeight=void 0===e?this.$iframeContent.outerHeight()+this.addressBarHeight:e+this.addressBarHeight,window.resizeTo(420,this.currentHeight))},this.isWidgetAvailable=function(){return t(window).height()>=500},this.onCheckoutClick=function(){return!0},this.onWidgetClick=function(){return!1},this.render=function(e){var i="SubscriptionsCart"===new URLSearchParams(window.location.search).get("type"),n=e.items.reduce((function(t,e){return t+e.quantity}),0),s=window.sellfy._.template(this.templates.base,{model:e,items:window.sellfy._.template(this.templates.items,{model:e,storeUrl:window.GLOBALS.STORE_URL,itemClassName:function(t){var e="";return!t.stock.unlimited&&t.quantity>t.stock.quantity&&(e+=" error"),e},itemMaxQty:function(t){return t.stock.unlimited?99:t.stock.quantity},isSubscriptionCart:i}),totals:window.sellfy._.template(this.templates.totals,{model:e}),subtotals:window.sellfy._.template(this.templates.subtotals,{model:e,checkoutUrl:window.GLOBALS.CHECKOUT_URL}),itemCount:n});this.model=e,this.$scope.toggleClass("empty-cart",!n),this.$counter.text(n||""),this.$(".checkout-items .qty.column").popup("hide"),this.$content.html(s),this.$(".checkout-items .error .qty.column").each((function(){var e=t(this);e.popup({distanceAway:-6,exclusive:!1,html:function(){return t("#lowStock").html().format(e.data("stock"))}})}))},this.hideLoader=function(t){this.$(".content").removeClass("loading"),this.resizeTo(),"function"==typeof t&&t()},this.showLoader=function(){this.$(".content").addClass("loading")},this.showErrorAlert=function(i){var n=t.extend({},this.templates.error,i);e.helpers.show_alert(n.header,n.error)},this.modelLoaded=function(t,e,i){this.render(i),"function"==typeof t&&t.call(this,i),"function"==typeof e&&e.call(this,i)},this.onFetch=function(){this.showLoader()},this.onFail=function(t){t.status>0&&(this.showErrorAlert(t.responseJSON),this.model&&this.render(this.model))},this.fetch=function(i){this.onFetch(),e.helpers.api[i.method](this.url({key:i.key}),i.data,t.proxy(this.modelLoaded,this,this.callback,i.callback),t.proxy(this.onFail,this),t.proxy(this.hideLoader,this,this.onFetchAlways))},this.removeItem=function(t,e){this.fetch({method:"delete",key:t,data:e})},this.addItem=function(t,e){this.fetch({method:"post",data:t,callback:e}),this.onItemBeforeAdd(t.product)},this.updateItem=function(t,e,i){this.fetch({method:"put",key:t,data:e,callback:i})},this.onItemRemoveClick=function(e){var i=t(e.currentTarget);return this.removeItem(i.data("key"),{variant:i.data("variant")}),!1},this.onItemBeforeAdd=function(t){window._ga&&(ga("clientTracker.ec:addProduct",{id:t}),ga("clientTracker.ec:setAction","add"),ga("clientTracker.send","event","ec-ecommerce-send","product","add-to-cart")),window._fb&&fbq("track","AddToCart",{content_type:"product",content_ids:t})},this.onItemAdd=function(t,e,i){t.upsell&&t.upsell.product.length?this.showUpsellOffer(t.upsell,e):(!1!==i&&this.openWidget(),"function"==typeof e&&e())},this.showUpsellOffer=function(i,n){var s={save_cart:!1,discount_id:i.id,product:i.product[0]};e.helpers.api.post(this.url(),s,t.proxy(this.upsellModal,this,i,n))},this.loadItems=function(t){this.fetch({method:"get",callback:t})},this.applyData=function(t,e){this.fetch({method:"put",data:t,callback:e})},this.openWidget=function(){this.$(".shopping-cart-button").popup("show")},this.closeWidget=function(){this.$(".shopping-cart-button").popup("hide")},this.toggleItemVisibility=function(){this.$scope.toggleClass("show-items"),this.resizeTo()},this.onSingleItemSubmit=function(e){var i=t(e.currentTarget).serializeObject();return this.updateItem(i.key,i),!1},this.onCartSubmit=function(e){return this.applyData(t(e.currentTarget).serializeObject()),!1},this.onSingleItemUpdate=function(e){var i=t(e.currentTarget).parents("form");this.$scope.find(".single-item-form .field.row").addClass("disabled"),i.find(".field.row").removeClass("disabled"),clearTimeout(this.formTimeoutId),this.formTimeoutId=setTimeout((function(){i.find(".submit").click()}),this.formTimeout)},this.events=function(){var e=this;this.$scope.on("click",".toggle-items",this.toggleItemVisibility.bind(this)).on("click",".remove-item",this.onItemRemoveClick.bind(this)).on("click",".checkout-button",this.onCheckoutClick.bind(this)).on("submit",".cart-form",this.onCartSubmit.bind(this)).on("submit",".single-item-form",this.onSingleItemSubmit.bind(this)).on("change",".single-item-field",this.onSingleItemUpdate.bind(this)),this.isWidgetAvailable()&&this.$(".shopping-cart-button").on("click",this.onWidgetClick.bind(this)).popup({duration:80,delay:{show:0,hide:0},on:"click",popup:this.$(".ui.popup"),context:this.$(window),position:"bottom right",onShow:t.proxy(this.onWidgetShow,this),onHide:t.proxy(this.onWidgetHide,this),lastResort:"bottom right"}),t("body").on("click",".add-to-shopping-cart.Cart",(function(){var i=t(this);return i.addClass("loading"),e.addItem({product:t(this).data("key"),discount_id:t(this).data("discount-id")},(function(t){i.removeClass("loading"),e.onItemAdd(t)})),!1}))},this.upsellModal=function(e,i,n){var s=e.product[0],r=n.items.find((function(t){return t.product.key===s}));if(r){var o=window.sellfy._.template(this.templates.upsell,{upsell:e,item:r}),a=t("#addToCart").html(),l=t("#outOfStock").html(),h=this;t(".upsell-modal").remove();var d=t(o).modal({onShow:function(){var e=t(this);e.find("img").on("load",(function(){t(window).resize()})).each((function(){this.complete&&t(this).load()}));var i=e.find(".approve.button");e.find(":input").on("change",(function(n){var s=t(n.currentTarget).find(":selected"),r=e.find(".image-container");r.html(s.data("image-html")),r.find("img").one("load",(function(){this.complete&&t(this).load()})),e.find(".price-old").html(s.data("price")),e.find(".price").html(s.data("total"));var o=s.data("outofstock");i.toggleClass("ui disabled",o),i.text(o?l:a)}))},onApprove:function(){var e=t(this);return e.find(".approve.button").text(h.templates.upsellApproveText),h.addItem(e.serializeForm(),(function(){e.modal("hide"),"function"==typeof i?i():h.openWidget()})),!1},onHide:function(){"function"==typeof i?i():h.openWidget()}}).modal("show");this.resizeTo(d.height())}},this.onInit=function(){},this.init=function(){this.$scope.length&&(this.loadItems(this.onInit),this.events(),this.resizeTo())},this.get=function(t){return this.model[t]}},this.sellfy=e}).call(window,jQuery),window.sellfy=window.sellfy||{},window.sellfy.views={},window.sellfy.App={Models:{},Collections:{},Views:{},Mixins:{},Helpers:{},Modules:{}},window.recaptchaLoaded=new Promise((function(t){var e=setInterval((function(){window.grecaptcha&&window.grecaptcha.render&&(clearInterval(e),t())}),100)})),sellfy.App.Models.Draft=Backbone.Model.extend({idAttribute:"key"}),sellfy.App.Models.GalleryItem=Backbone.Model.extend({}),sellfy.App.Collections.Gallery=Backbone.Collection.extend({model:sellfy.App.Models.GalleryItem}),sellfy.App.Views.CountrySelectionView=Backbone.View.extend({events:{"change select#registration_country":"onChangeCountry","change select#ship_country":"onChangeCountry","change select#ship_state":"onChangeState"},initialize:function(t){var e=t.parent,i=t.billing;this.parent=e,this.billing=i,this.currentCountry=sellfy.helpers.localStorage.get("Sellfy.Tracking.cookie",{}).country_code,this.currentState="",this.states=STATES[this.currentCountry]||{};var n=e.model,s=n.shipping,r=n.company_details;if(!i&&s&&s.address){var o=s.address,a=o.country,l=o.state;a&&(this.currentCountry=a,this.states=STATES[a]||{}),l&&(this.currentState=s.address.state)}i&&r&&r.registration_country&&(this.currentCountry=r.registration_country),this.render()},remove:function(){return this.undelegateEvents(),this.$el.empty(),this.stopListening(),this},onChangeCountry:function(t){var e=t.currentTarget.value;this.currentCountry=e,this.currentState="",this.states=STATES[e]||{},this.handleParentModelChange(),this.render()},onChangeState:function(t){var e=t.currentTarget.value;this.currentState=e,this.handleParentModelChange()},handleParentModelChange:function(){var t=this.parent,e=t.cart.model.is_shipping_required,i=t.b2bEnabled,n=t.draft;if(this.billing&&!e&&"1"===i||!this.billing){var s=this.currentState?"-"+this.currentState:"";this.parent.$("#buyer_location").val(""+this.currentCountry+s)}n.get("has_merch_products")?this.parent.populateModel():this.parent.loadDraft(),this.billing?this.parent.onChangeBillingCountry(this.currentCountry):this.parent.onShippingChange(),this.parent.$form.removeClass("error"),this.render()},render:function(){this.$el.html(window.sellfy._.template($("#userLocationView").html(),{countries:COUNTRIES,states:this.states,currentCountry:this.currentCountry,currentState:this.currentState,billing:this.billing})),this.parent.$("#buyer_location").val()||this.parent.$("#buyer_location").val(this.currentCountry)}}),sellfy.App.Views.ShippingInformationView=Backbone.View.extend({initialize:function(t){this.parent=t.parent,this.render(t.model)},remove:function(){return this.undelegateEvents(),this.$el.empty(),this.stopListening(),this},render:function(t){this.$el.html(window.sellfy._.template($("#shippingInformationView").html(),{hasMerch:this.parent.draft.get("has_merch_products"),b2bEnabled:"1"===this.parent.b2bEnabled,shippingRequired:this.parent.cart.model.is_shipping_required,model:t}))}});var _slicedToArray=function(t,e){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return function(t,e){var i=[],n=!0,s=!1,r=void 0;try{for(var o,a=t[Symbol.iterator]();!(n=(o=a.next()).done)&&(i.push(o.value),!e||i.length!==e);n=!0);}catch(t){s=!0,r=t}finally{try{!n&&a.return&&a.return()}finally{if(s)throw r}}return i}(t,e);throw new TypeError("Invalid attempt to destructure non-iterable instance")};function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,i=Array(t.length);e<t.length;e++)i[e]=t[e];return i}return Array.from(t)}sellfy.App.Views.CheckoutView=Backbone.View.extend({events:{'change input[name="payment_type"]':"onPaymentMethodChange",'change input[name^="shipping."]':"onShippingChange",'change select[name^="shipping."]':"onShippingChange",'change input[name="company_details.registration_number"]':"onRegNrChange","change #B2BCheckoutEnabled":"onEnableB2BCheckout","submit form":"onFormSubmit","change .checkbox.toc input":"onChangeTocValue"},urls:{initialize:function(t){return"/payments/initialize/{0}/".format(t)},finalize:function(t){return"/payments/finalize/{0}/".format(t)},subscriptionInitialize:"/billing/subscriptions/initialize/",subscriptionComplete:function(t,e){return"/billing/subscriptions/complete/{0}/?token={1}".format(t,e)},merchEstimate:"/printful/estimate_costs/"},rendered:!1,stripeTokenId:null,agreedToToc:!1,b2bEnabled:"0",registrationNumber:"",onChangeTocValue:function(){this.agreedToToc=this.$form.find(".checkbox.toc input").is(":checked")},onChangeBillingCountry:function(t){this.model.company_details.registration_country=t,this.showBillingView()},onRegNrChange:function(t){var e=t.currentTarget.value;this.model.company_details.registration_number=e,sellfy.helpers.inEU(this.model.company_details.registration_country)&&e&&this.onValidateRegNumber()},onValidateRegNumber:function(){var t=this;sellfy.helpers.api.post("/api/v2/validate-vat/",{vat_id:this.model.company_details.registration_number}).done((function(e){var i=e.company_address,n=e.company_name;e.valid&&(t.model.company_details.address=i,t.model.company_details.company_name=n,t.renderBillingView(),t.loadDraft())})).fail((function(e){t.$(".billing-information .one.field.reg-number .vat-input .validation-error").text(e.responseJSON.message||"VAT Number you provided is not valid or expired"),t.$(".billing-information .one.field.reg-number .vat-input").addClass("error")}))},memorizedDraftId:null,initialize:function(){this.draft=new sellfy.App.Models.Draft,this.model={shipping:{address:{}}},$("#buyer_location").val(sellfy.modules.analytics.countryCode),this.cart=new sellfy.CartView(".shopping-cart"),this.cart.callback=this.onCartLoaded.bind(this),this.cart.init(),this.cart.onFetch=this.onCartFetch.bind(this),this.cart.onFetchAlways=this.onCartFetchAlways.bind(this),this.listenToOnce(this.draft,"change",this.initApplePay)},checkAllShippingFields:function(t){var e=!0;return t.name||(e=!1),["city","country","line1","postal_code","phone"].forEach((function(i){t.address[i]||(e=!1)})),sellfy.helpers.needsState(t.address.country)&&(t.address.state||(e=!1)),e},onShippingChange:function(){var t=this.draft.get("has_merch_products"),e=this.$form.serializeForm().shipping||{},i=this;t&&this.checkAllShippingFields(e)&&this.loadDraft((function(){this.showLoader();var t={printful_items:[],printful_shipping:{address1:e.address.line1,address2:e.address.line2,city:e.address.city,country_code:e.address.country,name:e.name,state_code:e.address.state?e.address.state:"",zip:e.address.postal_code,phone:e.address.phone},cart_id:this.draft.get("cart_id")};this.draft.get("items").forEach((function(e){e.printful_id&&t.printful_items.push(e.printful_format)})),sellfy.helpers.api.post(this.urls.merchEstimate,t).done(this.handleCeleryTask.bind(this,(function(t){i.loadDraft()}))).fail(this.onDraftFail.bind(this)).always(this.onDraftAlways.bind(this))}))},draftUrl:function(){return"/order_draft/?visitor_id={0}".format(sellfy.helpers.getURLParameter(window.location.href,"visitor_id"))},toggleFormClass:function(){this.populateModel();var t=!(!this.cart.get("items")||0!==this.cart.get("items").length),e=!!this.cart.get("is_free"),i=this.cart.get("payment_methods");this.$el.toggleClass("empty",t),this.$form.toggleClass("no-payments",0===i.length&&!e),this.$form.toggleClass("download",e)},onEnableB2BCheckout:function(t){var e=t.currentTarget.value;this.b2bEnabled="1"===e?"0":"1",$("#B2BCheckoutEnabled").val(this.b2bEnabled),this.populateModel(),this.showBillingView()},showBillingView:function(){"1"!==this.b2bEnabled?(this.$(".billing-information").html(""),this.setShippingLocationDetails(),this.renderShippingView(),this.$(".buyer-information .shipping-location-container").show()):(this.setBillingLocationDetails(),this.renderShippingView(),this.renderBillingView(),this.cart.model.is_shipping_required||this.$(".buyer-information .shipping-location-container").hide())},setShippingLocationDetails:function(){if(this.model.company_details={},this.cart.model.is_shipping_required){var t=this.model.buyer_location.split("-"),e=_slicedToArray(t,2),i=e[0];e[1];this.model.shipping.address.country=i}},setBillingLocationDetails:function(){var t=this.model.buyer_location.split("-"),e=_slicedToArray(t,1)[0];e||(e=sellfy.helpers.localStorage.get("Sellfy.Tracking.cookie",{}).country_code),this.model.company_details=this.model.company_details||{},this.model.company_details.registration_country||(this.model.company_details.registration_country=e)},isSubscriptionCart:function(){return"SubscriptionsCart"===this.$("#cart_cls").val()},sendAnalytics:function(t){this.analyticsSent||(t.get("items").forEach((function(t){window._ga&&ga("clientTracker.ec:addProduct",{id:t.product.key,quantity:t.quantity})})),window._ga&&(ga("clientTracker.ec:setAction","checkout",{step:1}),ga("clientTracker.send","event","ec-ecommerce-send","product","checkout-1")),window._fb&&fbq("track","InitiateCheckout")),this.analyticsSent=!0},getPaymentMethodsAvailable:function(){var t=this.cart.model.payment_methods,e=[];if(t.find((function(t){return"stripe"===t.name}))&&e.push("stripe"),t.find((function(t){return"paypal_commerce"===t.name})))e=[].concat(_toConsumableArray(e),["paypal_commerce","paypal"]);else if(t.find((function(t){return"paypal"===t.name}))){t.find((function(t){return"paypal"===t.name})).client_id?e=[].concat(_toConsumableArray(e),["paypal_subscription","paypal"]):e.push("paypal")}this.availablePaymentMethods=e},onCartLoaded:function(){this.rendered||(this.getPaymentMethodsAvailable(),this.render()),this.cart.resizeTo(),this.loadDraft()},onCartFetch:function(){this.showLoader()},onCartFetchAlways:function(){this.hideLoader(),this.onShippingChange()},onDraftLoad:function(t,e){var i=t,n=void 0;Array.isArray(t)&&(i=t[0],n=t[1]),this.draft.get("items")&&this.draft.get("items").length!==e.items.length&&this.initApplePay(),this.draft.set(e),this.cart.render(this.draft.attributes),!n&&this.hideLoader(),"function"==typeof i&&i.call(this)},onDraftFail:function(t){return this.showError(t),t},onDraftAlways:function(){this.toggleFormClass(),this.changeCheckoutButton(),this.showBillingView()},populateModel:function(){this.model=this.$form.serializeForm()},loadDraft:function(t,e){this.showLoader(),this.populateModel();var i=$.extend(!0,{},this.model);this.cart.model.is_shipping_required&&"true"===this.model.save||delete i.shipping,this.initPayPal(),!e||this.validate()?sellfy.helpers.api.post(this.draftUrl(),i).done(this.onDraftLoad.bind(this,t)).fail(this.onDraftFail.bind(this)).always(this.onDraftAlways.bind(this)):this.showError(this.errorText)},validate:function(){var t=this;this.populateModel();var e=this.cart.model,i=e.is_shipping_required,n=e.has_merch_products,s=this.model.shipping||{},r=s.name,o=s.address,a=this.$form.find(".ui.segment.buyer-information"),l=this.$form.find(".checkbox.toc"),h=[],d=[],c=!0;i&&(d=[].concat(["name","city","country","line1","postal_code"])),n&&d.push("phone"),this.$form.find(".checkbox.toc").length&&d.push("toc"),o&&!window.sellfy._.isEmpty(STATES[o.country])&&d.push("state");var p=/^[+]*[(]{0,1}[0-9]{1,3}[)]{0,1}[-\s\./0-9]*$/g;d.forEach((function(e){"toc"===e?t.agreedToToc?l.removeClass("force"):(l.addClass("force"),c=!1,h.push("Terms and Conditions")):"phone"===e?o.phone&&p.test(o.phone)?a.find(".field.phone").removeClass("error"):(a.find(".field.phone").addClass("error"),c=!1,h.push("Phone")):"name"===e?r?a.find(".field.name").removeClass("error"):(a.find(".field.name").addClass("error"),c=!1):"line1"===e?o.line1&&!o.line1.includes("@")?a.find(".field.line1").removeClass("error"):(a.find(".field.line1").addClass("error"),c=!1,h.push("Address")):o[e]?a.find(".field."+e).removeClass("error"):(a.find(".field."+e).addClass("error"),c=!1,h.push(e.charAt(0).toUpperCase()+e.slice(1)))}));var u="Please fill out missing or incomplete fields: "+h.join(", ");return this.errorText=c?"":u,c},changeCheckoutButton:function(){var t=this.cart.model.is_free,e=this.availablePaymentMethods;t?(this.$form.find("#paypal-button-container").hide(),this.$form.find(".pay-button").show(),"paypal"===this.paymentMethod||t?this.$form.find(".cc-form.buy-now").hide():this.$form.find(".cc-form.buy-now").show()):(e.includes("paypal_commerce")||e.includes("paypal_subscription")&&this.isSubscriptionCart())&&"paypal"===this.paymentMethod?(this.$form.find("#paypal-button-container").show(),this.$form.find(".cc-form.buy-now").hide(),this.$form.find(".pay-button").hide()):(this.$form.find("#paypal-button-container").hide(),this.$form.find(".pay-button").show(),"paypal"===this.paymentMethod?this.$form.find(".cc-form.buy-now").hide():this.$form.find(".cc-form.buy-now").show())},onPaymentMethodChange:function(t){this.paymentMethod=t.currentTarget.value,this.$(".ui.checkbox").removeClass("checked"),$(t.currentTarget).parents(".ui.checkbox").addClass("checked"),this.changeCheckoutButton(),void 0===this.opened&&(this.opened=0),this.opened>1&&this.cart.resizeTo(),this.opened++},initStripe:function(){var t=this.cart.model.payment_methods,e=GLOBALS.CHECKOUT_TEXT_COLOR||"#666666";if(this.stripeUser=t.find((function(t){return"stripe"===t.name})),this.stripeKey=this.stripeUser&&this.stripeUser.public_key,this.stripeKey){var i={};this.stripeUser.account_id&&(i={stripeAccount:this.stripeUser.account_id}),this.stripe=new Stripe(this.stripeKey,i),this.stripeElements=this.stripe.elements(),this.cardNumber=this.stripeElements.create("card",{iconStyle:"solid",style:{base:{backgroundColor:"transparent",iconColor:e,color:e,fontWeight:400,fontFamily:"-apple-system, system-ui, sans-serif",fontSize:"14px",fontSmoothing:"antialiased","::placeholder":{color:"inherit"},":-webkit-autofill":{color:"#fce883"}},invalid:{iconColor:"#FF4949",color:"#FF4949"}}}),this.cardNumber.mount("#card_number")}},initApplePay:function(){this.applePayButton&&this.applePayButton.destroy();var t=this.cart.model.payment_methods,e=this.cart.model,i=e.is_shipping_required,n=e.has_merch_products;this.stripeUser=t.find((function(t){return"stripe"===t.name})),this.stripeKey=this.stripeUser&&this.stripeUser.public_key;var s=this;if(this.stripeKey&&this.stripeUser.apple_pay_enabled&&!this.isSubscriptionCart()){var r={country:this.stripeUser.seller_country,currency:this.draft.get("checkout_currency").toLowerCase(),total:{label:"Total",amount:this.draft.get("total_amount")},requestPayerName:!0,requestPayerEmail:!0,requestPayerPhone:i,requestShipping:i};i&&(r.shippingOptions=[{id:"main",label:"Standard shipping",amount:this.draft.get("shipping").amount}]),this.stripePaymentRequest=this.stripe.paymentRequest(r),this.stripePaymentRequest.on("shippingaddresschange",(function(t){$("#ship_country").val(t.shippingAddress.country);var e=t.shippingAddress,r=e.city,o=e.country,a=e.postalCode,l=e.region;if(n){var h={printful_items:[],printful_shipping:{address1:"REDACTED",address2:"",city:r,country_code:o,name:"REDACTED",state_code:l,zip:a,phone:"REDACTED"},cart_id:s.draft.get("cart_id")};s.draft.get("items").forEach((function(t){t.printful_id&&h.printful_items.push(t.printful_format)})),sellfy.helpers.api.post(s.urls.merchEstimate,h).done(s.handleCeleryTask.bind(s,(function(e){s.loadDraft((function(){t.updateWith({status:"success",shippingOptions:[{id:"main",label:"Standard shipping",amount:s.draft.get("shipping").amount}],total:{label:"Total",amount:s.draft.get("total_amount")}})}))}))).fail(s.onDraftFail.bind(s)).always(s.onDraftAlways.bind(s))}else if(i){var d=t.shippingAddress,c=d.city,p=d.country,u=d.postalCode,f=d.region,m=sellfy.helpers.needsState(p);s.model.shipping.address={city:c,country:p,line1:"",line2:"",postal_code:u,state:m?p+"-"+f:""},s.model.buyer_location=m?p+"-"+f:p;h=$.extend(!0,{},s.model);sellfy.helpers.api.post(s.draftUrl(),h).done(s.onDraftLoad.bind(s,(function(){t.updateWith({status:"success",shippingOptions:[{id:"main",label:"Standard shipping",amount:s.draft.get("shipping").amount}],total:{label:"Total",amount:s.draft.get("total_amount")}})}))).fail(s.onDraftFail.bind(s)).always(s.onDraftAlways.bind(s))}})),this.stripePaymentRequest.on("paymentmethod",(function(t){var e=$.extend(!0,{},s.model);e.save=!0,e.payer_email=t.payerEmail,i?(e.shipping.name=t.payerName,e.shipping.address.line1=t.shippingAddress.addressLine[0]||"",e.shipping.address.line2=t.shippingAddress.addressLine[1]||"",e.shipping.address.city=t.shippingAddress.city,e.shipping.address.postal_code=t.shippingAddress.postalCode,n&&(e.shipping.address.phone=t.shippingAddress.phone||"")):delete e.shipping,sellfy.helpers.api.post(s.draftUrl(),e).done(s.onDraftLoad.bind(s,(function(){sellfy.helpers.api.post(s.urls.initialize(s.draft.id),{payment_method:"stripe",payment_method_id:t.paymentMethod.id,window_type:s.getWindowType()}).done(s.handleCeleryTask.bind(this,[function(e){"FAILURE"===e.state?t.complete("fail"):e.success?(t.complete("success"),sellfy.helpers.redirect(e.redirect_url)):t.complete("fail")}]))}))).fail(s.onDraftFail.bind(s)).always(s.onDraftAlways.bind(s))})),this.applePayButton=this.stripeElements.create("paymentRequestButton",{paymentRequest:this.stripePaymentRequest,style:{paymentRequestButton:{type:"buy",theme:"dark"}}}),this.stripePaymentRequest.canMakePayment().then((function(t){t&&($(".apple-pay-container").addClass("visible"),s.applePayButton.mount("#payment-request-button"))})).catch((function(t){throw t}))}},initPayPal:function(){var t=this,e=this.cart.model,i=e.is_free,n=e.payment_methods,s=n.find((function(t){return"paypal_commerce"===t.name})),r=n.find((function(t){return"paypal"===t.name})),o="#paypal-button-container",a=!!this.$(o).length;if(!i&&a){var l=[{name:"currency",value:this.cart.model.checkout_currency},{name:"commit",value:"true"},{name:"intent",value:"capture"},{name:"vault",value:"false"}];s&&s.client_id?l=[{name:"client-id",value:s.client_id},{name:"merchant-id",value:s.merchant_id}].concat(_toConsumableArray(l)):r&&r.client_id&&this.isSubscriptionCart()&&(l=l.filter((function(t){return"merchant-id"!==t.name})),l=[{name:"client-id",value:r.client_id}].concat(_toConsumableArray(l))),this.isSubscriptionCart()&&l.forEach((function(t){"intent"===t.name&&(t.value="subscription"),"vault"===t.name&&(t.value="true")})),function(t,e){var i=document.createElement("script");i.setAttribute("src",t),i.setAttribute("data-partner-attribution-id","SellfyUAB_Cart_PPCP"),i.onload=e,document.head.insertBefore(i,document.head.firstElementChild)}(l.reduce((function(t,e,i){return t+(0===i?"?":"&")+e.name+"="+e.value}),"https://www.paypal.com/sdk/js"),(function(){paypal.Buttons({style:{color:"gold",shape:50==window.GLOBALS.STORE_PRIMARY_BUTTON_RADIUS?"pill":"rect",size:"small",height:55,layout:"vertical",label:"paypal",fundingicons:!1,tagline:!1},onClick:function(e,i){if(!t.validate())return t.showError(t.errorText),i.reject();t.$form.removeClass("error").find("#save").val(!0),t.showLoader(),t.populateModel();var n=$.extend(!0,{},t.model);return t.cart.model.is_shipping_required&&"true"===t.model.save||delete n.shipping,new Promise((function(e,s){sellfy.helpers.api.post(t.draftUrl(),n).done(t.onDraftLoad.bind(t,[function(){return e(i.resolve())},!0])).fail((function(n){t.showError(n),t.hideLoader(),e(i.reject())})).always(t.onDraftAlways.bind(t))}))},createOrder:t.isSubscriptionCart()?void 0:function(){return t.memorizedDraftId=t.draft.id,new Promise((function(e,i){sellfy.helpers.api.post(t.urls.initialize(t.memorizedDraftId),{payment_method:"paypal_rest",window_type:"desktop"}).done(t.handleCeleryTask.bind(t,[function(n){"FAILURE"===n.state?(t.hideLoader(),t.showError(n.error),i(n.error)):n.success?(t.hideLoader(),e(n.id)):i("Something went wrong, try again later.")}])).fail((function(e){t.hideLoader(),i("Something went wrong, try again later.")}))}))},onShippingChange:function(t,e){return e.resolve()},createSubscription:t.isSubscriptionCart()?function(){return new Promise((function(e,i){var n=r&&r.client_id?"paypal":"paypal_rest";sellfy.helpers.api.post("/billing/subscriptions/initialize/",{draft_key:t.draft.id,type:n,plan_id:t.draft.get("plan_id"),paypal_endpoint_type:t.getWindowType(),source:t.stripeTokenId}).done(t.handleCeleryTask.bind(t,[function(n){"FAILURE"===n.state?(t.hideLoader(),t.showError(n.error),i(n.error)):n.success?(t.hideLoader(),t.memorizedSubscriptionData=n,e(n.subscription_id)):i("Something went wrong, try again later."),t.hideLoader()}])).fail((function(e){t.hideLoader(),t.showError(e),i(e)}))}))}:void 0,onApprove:function(e,i){if(t.showLoader(),t.isSubscriptionCart()){var n=t.memorizedSubscriptionData,s=n.contract_id,r=n.subscription_id;sellfy.helpers.redirect(t.urls.subscriptionComplete(s,r))}else sellfy.helpers.api.post(t.urls.finalize(t.memorizedDraftId),{payment_method:"paypal_rest",window_type:"desktop",order_id:e.orderID}).done((function(t){sellfy.helpers.redirect(t.download_url,!0)})).fail((function(e){if(t.showError.bind(t),"INSTRUMENT_DECLINED"===e.responseJSON.error)return i.restart();t.hideLoader()}))},onError:function(e,i){t.hideLoader(),t.showError(e)},onCancel:function(){t.hideLoader()}}).render(o)}))}},renderBillingView:function(){if("1"===this.b2bEnabled){this.billingInformationView=this.$(".billing-information").html(window.sellfy._.template($("#billingInformationView").html(),{model:this.model,company_details:this.model.company_details}));var t=$.extend(!0,{},this.model,{company_details:this.model.company_details});new sellfy.App.Views.CountrySelectionView({el:this.billingInformationView.find(".billing-location"),model:t,parent:this,billing:!0})}},renderShippingView:function(){var t;this.cart.model.is_shipping_required?this.shippingInformationView?this.shippingInformationView.render(this.model):this.shippingInformationView=new sellfy.App.Views.ShippingInformationView({el:this.$(".shipping-information"),model:this.model,parent:this,b2bEnabled:"1"===this.b2bEnabled,isShippingRequired:this.cart.model.is_shipping_required,hasMerch:this.cart.model.has_merch_products}):this.shippingInformationView&&(this.shippingInformationView.remove(),this.shippingInformationView=null),(this.cart.model.is_shipping_required||this.cart.model.is_location_requested)&&(t=this.$(".buyer-information .location")),t?this.countrySelectView?this.countrySelectView.render():this.countrySelectView=new sellfy.App.Views.CountrySelectionView({el:t,model:this.model,parent:this}):this.countrySelectView&&(this.countrySelectView.remove(),this.countrySelectView=null)},render:function(){this.$form=this.$("#checkoutForm");var t=this.availablePaymentMethods,e=this.$('input[name="payment_type"]');this.renderShippingView(),this.renderBillingView(),t.includes("paypal")&&!t.includes("paypal_commerce")&&!t.includes("paypal_subscription")&&this.isSubscriptionCart()?(this.$form.find(".ui.radio.paypal").hide(),t.includes("stripe")?e.eq(1).prop("checked","true").trigger("change"):(this.$form.find("#submit_checkout .buy-now").hide(),this.$form.find("#submit_checkout .not-available").show(),this.$form.find("#submit_checkout.pay-button").addClass("disabled"))):e.first().prop("checked","true").trigger("change"),this.$(".ui.checkbox").checkbox(),sellfy.helpers.addAnalyticsToken(this.$("#csrf_draft_token")),this.initStripe(),this.changeCheckoutButton(),this.$("#cart").val(this.cart.model.key),this.$("#current_url").val(window.location.href),this.sendAnalytics(this.cart),this.rendered=!0},hideLoader:function(){this.$form.removeClass("loading"),this.cart.hideLoader()},showLoader:function(){this.$form.addClass("loading"),this.cart.showLoader()},getError:function(t){try{t=t.responseJSON.error}catch(t){}return t},showError:function(t){this.hideLoader(),this.$form.addClass("error"),this.$(".validation-error-field .error-text").html(this.getError(t))},getWindowType:function(){var t=window.location.href;return~t.indexOf("/iframe/")?"iframe":~t.indexOf("/wix/")?"wix":"desktop"},handleCeleryTask:function(t,e){var i=this;sellfy.helpers.getAsyncResult(e,{success:function(e){Array.isArray(t)?t[0](e):t(e)},error:function(e){Array.isArray(t)?t[0](e):i.showError(e.error)}})},proceedToPayment:function(t){var e="paypal"===this.paymentMethod,i=this.paymentMethod;this.draft.get("is_free")&&(i="download"),i?sellfy.helpers.api.post(this.urls.initialize(this.draft.id),{payment_method:i,window_type:this.getWindowType(),source:t}).done(this.handleCeleryTask.bind(this,(function(t){e?window.top.location.href=t.redirect_url:sellfy.helpers.redirect(t.redirect_url)}))).fail(this.showError.bind(this)):this.showError("Please select payment method")},getStripeData:function(){var t={};return this.$form.find("[data-stripe]").each((function(){t[$(this).data("stripe")]=this.value})),t},onStripeResponse:function(t,e){e.error?this.showError(e.error.message):t(e)},proceedWithStripe:function(t){this.stripe.createToken(this.cardNumber,this.getStripeData()).then(this.onStripeResponse.bind(this,t))},proceedWithStripeIntent:function(t){this.stripe.createPaymentMethod("card",this.cardNumber,{billing_details:this.getStripeData()}).then(this.onStripeResponse.bind(this,t))},onStripeIntentReady:function(t){sellfy.helpers.api.post(this.urls.initialize(this.draft.id),{payment_method:this.paymentMethod,window_type:this.getWindowType(),payment_method_id:t.paymentMethod.id}).done(this.handleCeleryTask.bind(this,this.handleStripeIntentResp.bind(this))).fail(this.showError.bind(this))},handleStripeIntentResp:function(t){var e=t.redirect_url;t.requires_action?this.stripe.handleCardAction(t.payment_intent_client_secret).then(this.onStripeResponse.bind(this,(function(){sellfy.helpers.redirect(e)}))):sellfy.helpers.redirect(e)},proceedWithSubscription:function(t,e){var i=this;sellfy.helpers.api.post(this.urls.subscriptionInitialize,{draft_key:this.draft.id,type:t,plan_id:this.draft.get("plan_id"),paypal_endpoint_type:this.getWindowType(),source:this.stripeTokenId},(function(t){sellfy.helpers.getAsyncResult(t,{success:e,error:function(){i.showError($("#proceedWithPaypalSubscriptionError").html())}})}),(function(t){i.showError(t)}))},redirectToPayPal:function(t){t.url?window.top.location.href=t.url:this.showError(t.error)},initializeStripeSubscription:function(t){this.stripeTokenId=t.token.id,this.proceedWithSubscription("stripe",this.finalizeStripeSubscription.bind(this))},finalizeStripeSubscription:function(t){t.client_secret?this.stripe.handleCardPayment(t.client_secret,this.cardNumber).then(this.onStripeResponse.bind(this,this.onStripeSubscriptionFinalize.bind(this,t))):this.onStripeSubscriptionFinalize(t)},onStripeSubscriptionFinalize:function(t){sellfy.helpers.redirect(this.urls.subscriptionComplete(t.contract_id,t.subscription_id))},proceedToPaymentProcessor:function(){this.showLoader(),this.draft.get("is_free")?this.proceedToPayment():"stripe"===this.paymentMethod?this.isSubscriptionCart()?this.proceedWithStripe(this.initializeStripeSubscription.bind(this)):this.proceedWithStripeIntent(this.onStripeIntentReady.bind(this)):this.proceedToPayment()},onFormSubmit:function(){return this.$form.removeClass("error").find("#save").val(!0),this.loadDraft(this.proceedToPaymentProcessor,!0),!1}}),sellfy.App.Views.CancelSubscriptionView=Backbone.View.extend({initialize:function(t){var e=this;this.$cancelButton=this.$(".cancel-subscription"),t.render?window.recaptchaLoaded.then((function(){e.captchaButton=grecaptcha.render(e.$cancelButton[0],{callback:e.onCaptchaCallback.bind(e)})})):window.cancelSubscription=this.onCaptchaCallback.bind(this)},onCaptchaCallback:function(t){sellfy.helpers.show_prompt("Confirm action","Are you sure you want to cancel this subscription?",this.cancelSubscription.bind(this,t)),grecaptcha.reset()},onSubscriptionError:function(){sellfy.helpers.show_notification("Failed to cancel subscription!","error"),this.$cancelButton.removeClass("loading")},onSubscriptionCanceled:function(t){sellfy.helpers.show_notification("Subscription canceled!","success"),this.$cancelButton.hide()},onSubscriptionCancelRequest:function(t){sellfy.helpers.getAsyncResult(t,{success:this.onSubscriptionCanceled.bind(this),error:this.onSubscriptionError.bind(this)})},cancelSubscription:function(t){this.$cancelButton.addClass("loading"),sellfy.helpers.api.delete("/billing/subscriptions/download/{0}/".format(this.$cancelButton.data("id")),{"g-recaptcha-response":t}).done(this.onSubscriptionCancelRequest.bind(this)).fail(this.onSubscriptionError.bind(this))}}),sellfy.App.Views.SearchView=Backbone.View.extend({events:{"focus input":"onFocus","click .dripicons-arrow-thin-left":"onClose","click .icon":"onClick"},onFocus:function(){this.$el.addClass("active")},onClose:function(){this.$el.removeClass("active")},onClick:function(){this.$el.serializeForm().search&&this.$el.hasClass("active")?this.$el.submit():this.$("input").focus()}}),sellfy.App.Views.GalleryView=Backbone.View.extend({initialize:function(t){this.gallery=new sellfy.App.Collections.Gallery(t.gallery),this.collection=new sellfy.App.Collections.Gallery,this.listenTo(this.collection,"reset",this.render),this.collection.reset(this.gallery.models)},update:function(t){t=t.split(",");var e=this.gallery.filter((function(e){return~t.indexOf(e.id)}));this.collection.reset(e)},render:function(){if(this.$el.html(window.sellfy._.template($("#productPageGalleryView").html(),{gallery:this.collection})),this.$(".carousel").length){this.$(".carousel").gallerio().data("plugin_gallerio").init();for(var t=document.querySelectorAll(".carousel .slides .slide iframe"),e=document.querySelector(".carousel").offsetWidth,i=0;i<t.length;++i){var n=t[i];isNaN(n.width)||isNaN(n.height)||(n.height=Math.ceil(e*n.height/n.width),n.width=e)}}}}),function(t){var e=new URL(location);e.searchParams.get("auth")&&(e.searchParams.delete("auth"),t.history.replaceState(null,null,e),sellfy.helpers.localStorage.set("Sellfy.UI.loggedIn",{enabled:!0},26e4))}(window),new sellfy.App.Views.SearchView({el:".store-search"}),window.initMobileMenu=function(){var t=[],e=$(".item-grid"),i=e.find(".column"),n=$(".back-action"),s=$(".close"),r=function(){var s=0;t.map((function(t,e){t.visible&&s++;var r=$(i[e+1]),o=r.find(".items");n.hasClass("visible")||n.addClass("visible"),o.removeClass("visible"),r.find('.items[data-menu-id="'+t.menuId+'"]').addClass("visible")})),t.length||n.removeClass("visible");var r="item-grid";1===s&&(r+=" second"),2===s&&(r+=" third"),e.attr("class",r)};e.find(".parent-item").on("click",(function(e){e.preventDefault();var i=$(this).data("id");t.push({menuId:i,visible:!0}),r()})),s.on("click",(function(){t=[],r()})),n.on("click",(function(){t.pop(),r()}))},$((function(){$(".navigation-overflow.overflow").overflowDropdown(),$(".ui.dropdown").dropdown(),sellfy.helpers.localStorage.get("Sellfy.UI.loggedIn")&&($(".user-panel").html(window.sellfy._.template($("#userPanel").html(),{product_id:window.GLOBALS.PRODUCT_ID,product_type:window.GLOBALS.PRODUCT_TYPE})),$(".slfy-store").addClass("logged-in"));var t=$(".mobile-menu .menu-container");t.find("menu-panel");$(".open-mobile-menu").on("click",(function(){t.toggleClass("visible")})),t.find(".close").on("click",(function(){t.removeClass("visible")})),initMobileMenu();var e=function(t,e,i){var n=e.find(".module");n.addClass("loading");var s="/render-api/module/products/"+e.data("moduleid")+"/?page="+("page"===t?i:1),r=n.find(".product-sort-menu input").val();r&&(s+="&order_by="+r),$.get(s,(function(t){e.html(t),requestAnimationFrame((function(){e[0].scrollIntoView({behavior:"smooth",block:"start"})})),$(".navigation-overflow.overflow").overflowDropdown(),$(".ui.dropdown").dropdown(),n.removeClass("loading")}))};$(".module-wrapper.products").on("click",".pagination a",(function(t){var i=t.currentTarget,n=$(i).parents(".module-wrapper"),s=$(i).data("page");if(s)return e("page",n,s),!1})),$(".module-wrapper.products").on("click",".product-sort-menu .dropdown.sort-by .menu .item",(function(t){var i=$(t.currentTarget).parents(".module-wrapper");return e("sortBy",i),!1}))})),$(".store-language select").on("change",(function(){var t=$(this),e=new Date;e.setTime(e.getTime()+63072e6),document.cookie="locale={0}; expires={1}; path=/".format(t.val(),e.toUTCString()),document.location.reload()}));try{sellfy.modules.analytics.ready.then((function(){sellfy.modules.analytics.track()}))}catch(t){}